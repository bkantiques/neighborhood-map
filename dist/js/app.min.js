function googleSuccess(){$(document).ready(function(){function a(){function a(a){var b=a.coords.latitude,c=a.coords.longitude,d={lat:b,lng:c};i.geocode({location:d},function(a,b){if(b==google.maps.GeocoderStatus.OK){for(var c=!1,d=0;d<a.length&&!c;d++){var e=a[d];e.types&&e.types.includes("neighborhood")&&e.formatted_address&&(c=!0,g.neighborhoodSearchTerm(e.formatted_address),g.neighborhoodSearch())}c||g.neighborhoodSearchMessage("Google could not find a named neighborhood for your location")}else g.neighborhoodSearchMessage("Could not find neighborhood for your location")})}function e(a){switch(a.code){case a.PERMISSION_DENIED:g.neighborhoodSearchMessage("User denied the request for Geolocation.");break;case a.POSITION_UNAVAILABLE:g.neighborhoodSearchMessage("Location information is unavailable.");break;case a.TIMEOUT:g.neighborhoodSearchMessage("The request to get user location timed out.");break;case a.UNKNOWN_ERROR:g.neighborhoodSearchMessage("An unknown error occurred while getting your location.")}}function f(a){return a.term.toLowerCase().trim()===this.toLowerCase().trim()}var g=this;g.neighborhoodSelectionViewActive=ko.observable(!0),g.neighborhoodMapViewActive=ko.observable(!1),g.neighborhoodSearchTerm=ko.observable(),g.neighborhoodSearchMessage=ko.observable(),g.neighborhood=ko.observable(),g.places=ko.observableArray(),g.selectedPlace=ko.observable(),g.placeSearchMessage=ko.observable(),g.filterTerm=ko.observable(""),g.autocompleteTerms=ko.observableArray(),g.mouseOnAutocomplete=ko.observable(!1),g.filterFieldHasFocus=ko.observable(),g.menuHiddenMobile=ko.observable(!0);var h=new google.maps.places.PlacesService(d.map),i=new google.maps.Geocoder;g.getGeolocation=function(){g.clearNeighborhoodErrorMessage(),navigator.geolocation?navigator.geolocation.getCurrentPosition(a,e):g.neighborhoodSearchMessage("Geolocation is not supported by this browser.")},g.neighborhoodSearch=function(){var a={query:g.neighborhoodSearchTerm(),types:["neighborhood"]};h.textSearch(a,g.neighborhoodSearchCallback),g.saveNeighborhoodSearchTerm()},g.neighborhoodSearchCallback=function(a,c){if(c==google.maps.places.PlacesServiceStatus.OK){var e=a[0];NeighborhoodDataValidator.validNeighborhood(e)?(g.neighborhood(new b(e)),g.placeSearchMessage(""),d.setMapNeighborhood(g.neighborhood()),g.getYelp()):g.neighborhoodSearchMessage("No valid neighborhood found")}else g.neighborhoodSearchMessage("Neighborhood not found")},g.clearNeighborhoodErrorMessage=function(){g.neighborhoodSearchMessage("")},g.switchToMapView=function(){location.hash="neighborhood-map"},g.switchToSelectionView=function(){location.hash="neighborhood-selection"},g.getYelp=function(){var a={consumerKey:"44oJjV_MOKpCQDbKmumHRQ",consumerSecret:"XsOHFUWokDcd4jH3MXZsKkzKTpA",accessToken:"ytwKY1JLEXuVNksN854geugdAz9HiFjo",accessTokenSecret:"B_dljIo2u4h1nAn-YGG48KN44dY",serviceProvider:{signatureMethod:"HMAC-SHA1"}},b={consumerSecret:a.consumerSecret,tokenSecret:a.accessTokenSecret};parameters=[],parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",a.consumerKey]),parameters.push(["oauth_consumer_secret",a.consumerSecret]),parameters.push(["oauth_token",a.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var c=this.neighborhood(),d={action:"http://api.yelp.com/v2/search?limit=10&sort=2&bounds="+c.minLatitude+","+c.minLongitude+"|"+c.maxLatitude+","+c.maxLongitude,method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(d),OAuth.SignatureMethod.sign(d,b);var e=OAuth.getParameterMap(d.parameters);e.oauth_signature=OAuth.percentEncode(e.oauth_signature);var f=this.yelpCallback;$.ajax({url:d.action,data:e,cache:!0,dataType:"jsonp",jsonpCallback:"cb",context:this,success:f,timeout:1e4,error:function(){this.neighborhoodSearchMessage("Error retrieving data from Yelp")}})},g.yelpCallback=function(a){if(a.businesses){d.removeMarkers(g.places());var b=[];a.businesses.forEach(function(a,e){if(PlaceDataValidator.validPlace(a)){var f=new c(a);d.createMarker(f),f.mapMarker.addListener("click",g.setSelectedPlace.bind(f)),f.isSelectedPlace=ko.computed(function(){return this===g.selectedPlace()},f),f.passesFilter=ko.computed(function(){var a=g.filterTerm().toLowerCase().trim(),b=!1,c=this.name.toLowerCase(),e=this.categories;this.mapMarker;if(""===a)b=!0;else if(-1!=c.indexOf(a))b=!0;else for(var f=0;f<e.length;f++){var h=e[f].name.toLowerCase();-1!=h.indexOf(a)&&(b=!0)}return d.filterMarker(this,b),b},f),b.push(f)}}),this.places(b),0===b.length&&g.placeSearchMessage("No places found in this neighborhood"),g.clearAutocompleteTerms(),g.setAutocompleteTerms(),g.switchToMapView()}},g.setSelectedPlace=function(){g.selectedPlace()&&!this.isSelectedPlace()&&d.unsetSelectedPlace(g.selectedPlace()),d.setSelectedPlace(this),g.selectedPlace(this),g.getFlickr()},g.clearAutocompleteTerms=function(){g.autocompleteTerms([])},g.setAutocompleteTerms=function(){g.places().forEach(function(a){a.categories&&a.categories.length&&a.categories.forEach(function(a){a.name&&g.createAutocompleteItem(a.name)})}),g.places().forEach(function(a){g.createAutocompleteItem(a.name)})};$("filter-term");g.createAutocompleteItem=function(a){if(-1==g.autocompleteTerms().findIndex(f,a)){var b={};b.term=a,b.containsFilterTerm=ko.computed(function(){var b=a.toLowerCase().trim(),c=g.filterTerm().toLowerCase().trim();return-1!=b.indexOf(c)},b),b.setFilterTerm=function(a,b){g.filterTerm(this.term)},g.autocompleteTerms.push(b)}},g.setMouseOnAutocomplete=function(){g.mouseOnAutocomplete(!0)},g.unsetMouseOnAutocomplete=function(){g.mouseOnAutocomplete(!1)},g.getFlickr=function(){var a=g.selectedPlace(),b=g.neighborhood(),c=b.minLatitude,d=b.maxLatitude,e=b.minLongitude,f=b.maxLongitude,h=encodeURIComponent(a.name),i="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=77a746b0c8b2484f233cb269061a8b21&extras=url_s,tags&sort=relevance&bbox="+e+","+c+","+f+","+d+"&tags="+h;$.get(i,function(b){var c=b.getElementsByTagName("photo");if(c.length>0){var d=c[0],e=d.getAttribute("url_s");e?a.flickrPhoto(e):a.flickrMessage("No flickr photo url found")}else a.flickrMessage("No flickr photo found")}).fail(function(){a.flickrMessage("Flickr photo request failed")})},Sammy(function(){this.get("#neighborhood-selection",function(){g.neighborhoodMapViewActive(!1),g.neighborhoodSelectionViewActive(!0),g.saveNeighborhoodMapViewActive()}),this.get("#neighborhood-map",function(){g.neighborhoodSelectionViewActive(!1),g.neighborhoodMapViewActive(!0),g.saveNeighborhoodMapViewActive()}),this.get("",function(){this.app.runRoute("get","#neighborhood-selection")})}).run(),g.toggleMenuHiddenMobile=function(){g.menuHiddenMobile(!g.menuHiddenMobile())},g.localStorageAvailable=function(){try{var a=window.localStorage,b="__storage_test__";return a.setItem(b,b),a.removeItem(b),!0}catch(c){return!1}},g.saveNeighborhoodSearchTerm=function(){g.localStorageAvailable()&&localStorage.setItem("neighborhoodSearchTerm",g.neighborhoodSearchTerm())},g.saveNeighborhoodMapViewActive=function(){g.localStorageAvailable()&&localStorage.setItem("neighborhoodMapViewActive",g.neighborhoodMapViewActive())},g.load=function(){if(g.localStorageAvailable()){var a=localStorage.getItem("neighborhoodSearchTerm");if(a){g.neighborhoodSearchTerm(a);var b=localStorage.getItem("neighborhoodMapViewActive");"true"===b&&g.neighborhoodSearch()}}},g.load()}var b=function(a){var b=a.geometry.viewport,c=b.getSouthWest(),d=b.getNorthEast();this.minLatitude=c.lat(),this.maxLatitude=d.lat(),this.minLongitude=c.lng(),this.maxLongitude=d.lng(),this.name=a.name,this.formattedAddress=a.formatted_address},c=function(a){var b=this;this.name=a.name,this.coordinate=a.location.coordinate,this.rating=a.rating,this.url=a.url,this.categories=[],this.address=a.location.address[0],this.phone=a.phone||"No phone information",this.snippetText=a.snippet_text||"No review snippet available",a.categories.forEach(function(a){b.categories.push({name:a[0],code:a[1]})}),this.flickrPhoto=ko.observable(),this.flickrMessage=ko.observable()},d=function(){function a(a){for(var b=a.categories,c=null,d=0;!c&&d<b.length;)category=b[d].code,"pizza"===category?c="pizza.png":"italian"===category?c="restaurant_italian.png":"coffee"===category?c="coffee.png":"bakeries"===category?c="bakery.png":"barbers"===category?c="barber.png":"beer_and_wine"!==category&&"bars"!==category||(c="beer.png"),d++;return c}var b={},c={center:new google.maps.LatLng(0,0),zoom:15};return b.map=new google.maps.Map(document.getElementById("map"),c),b.infowindow=new google.maps.InfoWindow({maxWidth:250}),b.setMapNeighborhood=function(a){var b={south:a.minLatitude,west:a.minLongitude,north:a.maxLatitude,east:a.maxLongitude};this.map.fitBounds(b)},b.unsetSelectedPlace=function(a){a.mapMarker.setAnimation(null)},b.setSelectedPlace=function(a){a.mapMarker.setAnimation(google.maps.Animation.BOUNCE),this.infowindow.setContent('<div class="infowindow"><div>Name: '+a.name+"</div><div>Category: "+a.categories[0].name+"</div><div>Rating: "+a.rating+"</div><div>Review snippet: "+a.snippetText+"</div></div>"),this.infowindow.open(this.map,a.mapMarker),this.map.panTo(a.mapMarker.getPosition())},b.stopSelectedPlaceAnimation=function(){e.selectedPlace().mapMarker.setAnimation(null)},google.maps.event.addListener(b.infowindow,"closeclick",b.stopSelectedPlaceAnimation),b.createMarker=function(c){var d={position:{lat:c.coordinate.latitude,lng:c.coordinate.longitude},map:b.map,title:c.name},e=a(c);e&&(e="images/map_icons/"+e,d.icon=e);var f=new google.maps.Marker(d);c.mapMarker=f},b.filterMarker=function(a,c){var d=a.mapMarker;c?d.setVisible(!0):(d.setAnimation(null),d.setVisible(!1),a.isSelectedPlace()&&b.infowindow.close())},b.removeMarkers=function(a){this.infowindow.close();for(var b=0;b<a.length;b++){var c=a[b].mapMarker;c.setMap(null)}},window.onresize=function(){e.neighborhood()&&b.setMapNeighborhood(e.neighborhood())},b}(),e=new a;ko.applyBindings(e)})}function googleError(){var a=$("#neighborhood-search-message");a.html('<span class="error-message">Error retrieving google map scripts. This app cannot function without these scripts.</span>');var b=$(".menu"),c=$(".hamburger-button"),d=$(".map-container");b.hide(),c.hide(),d.hide()}!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):jQuery.sammy=window.Sammy=a(jQuery)}(function(a){var b,c="([^/]+)",d=/:([\w\d]+)/g,e=/\?([^#]*)?$/,f=function(a){return Array.prototype.slice.call(a)},g=function(a){return"[object Function]"===Object.prototype.toString.call(a)},h=function(a){return"[object Array]"===Object.prototype.toString.call(a)},i=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},j=function(a){return decodeURIComponent((a||"").replace(/\+/g," "))},k=encodeURIComponent,l=function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},m=function(a){return function(){return this.route.apply(this,[a].concat(Array.prototype.slice.call(arguments)))}},n={},o=!(!window.history||!history.pushState),p=[];return b=function(){var c,d,e=f(arguments);return b.apps=b.apps||{},0===e.length||e[0]&&g(e[0])?b.apply(b,["body"].concat(e)):"string"==typeof(d=e.shift())?(c=b.apps[d]||new b.Application,c.element_selector=d,e.length>0&&a.each(e,function(a,b){c.use(b)}),c.element_selector!=d&&delete b.apps[d],b.apps[c.element_selector]=c,c):void 0},b.VERSION="0.7.6",b.addLogger=function(a){p.push(a)},b.log=function(){var c=f(arguments);c.unshift("["+Date()+"]"),a.each(p,function(a,d){d.apply(b,c)})},"undefined"!=typeof window.console?"function"==typeof window.console.log&&g(window.console.log.apply)?b.addLogger(function(){window.console.log.apply(window.console,arguments)}):b.addLogger(function(){window.console.log(arguments)}):"undefined"!=typeof console&&b.addLogger(function(){console.log.apply(console,arguments)}),a.extend(b,{makeArray:f,isFunction:g,isArray:h}),b.Object=function(b){return a.extend(this,b||{})},a.extend(b.Object.prototype,{escapeHTML:l,h:l,toHash:function(){var b={};return a.each(this,function(a,c){g(c)||(b[a]=c)}),b},toHTML:function(){var b="";return a.each(this,function(a,c){g(c)||(b+="<strong>"+a+"</strong> "+c+"<br />")}),b},keys:function(a){var b=[];for(var c in this)g(this[c])&&a||b.push(c);return b},has:function(b){return this[b]&&""!==a.trim(this[b].toString())},join:function(){var a=f(arguments),b=a.shift();return a.join(b)},log:function(){b.log.apply(b,arguments)},toString:function(b){var c=[];return a.each(this,function(a,d){g(d)&&!b||c.push('"'+a+'": '+d.toString())}),"Sammy.Object: {"+c.join(",")+"}"}}),b.targetIsThisWindow=function(b,c){var d=a(b.target).closest(c);if(0===d.length)return!0;var e=d.attr("target");return e&&e!==window.name&&"_self"!==e?"_blank"===e?!1:"top"===e&&window===window.top:!0},b.DefaultLocationProxy=function(a,b){this.app=a,this.is_native=!1,this.has_history=o,this._startPolling(b)},b.DefaultLocationProxy.fullPath=function(a){var b=a.toString().match(/^[^#]*(#.+)$/),c=b?b[1]:"";return[a.pathname,a.search,c].join("")},a.extend(b.DefaultLocationProxy.prototype,{bind:function(){var c=this,d=this.app,e=b.DefaultLocationProxy;a(window).bind("hashchange."+this.app.eventNamespace(),function(a,b){c.is_native!==!1||b||(c.is_native=!0,window.clearInterval(e._interval),e._interval=null),d.trigger("location-changed")}),o&&!d.disable_push_state&&(a(window).bind("popstate."+this.app.eventNamespace(),function(a){d.trigger("location-changed")}),a(document).delegate("a","click.history-"+this.app.eventNamespace(),function(a){if(!(a.isDefaultPrevented()||a.metaKey||a.ctrlKey)){var f=e.fullPath(this),g=this.hostname?this.hostname:function(a){var b=document.createElement("a");return b.href=a.href,b.hostname}(this);return g==window.location.hostname&&d.lookupRoute("get",f)&&b.targetIsThisWindow(a,"a")?(a.preventDefault(),c.setLocation(f),!1):void 0}})),e._bindings||(e._bindings=0),e._bindings++},unbind:function(){a(window).unbind("hashchange."+this.app.eventNamespace()),a(window).unbind("popstate."+this.app.eventNamespace()),a(document).undelegate("a","click.history-"+this.app.eventNamespace()),b.DefaultLocationProxy._bindings--,b.DefaultLocationProxy._bindings<=0&&(window.clearInterval(b.DefaultLocationProxy._interval),b.DefaultLocationProxy._interval=null)},getLocation:function(){return b.DefaultLocationProxy.fullPath(window.location)},setLocation:function(a){if(/^([^#\/]|$)/.test(a)&&(a=o&&!this.app.disable_push_state?"/"+a:"#!/"+a),a!=this.getLocation()){if(!o||this.app.disable_push_state||!/^\//.test(a))return window.location=a;history.pushState({path:a},window.title,a),this.app.trigger("location-changed")}},_startPolling:function(c){var d=this;if(!b.DefaultLocationProxy._interval){c||(c=10);var e=function(){var c=d.getLocation();"undefined"!=typeof b.DefaultLocationProxy._last_location&&c==b.DefaultLocationProxy._last_location||window.setTimeout(function(){a(window).trigger("hashchange",[!0])},0),b.DefaultLocationProxy._last_location=c};e(),b.DefaultLocationProxy._interval=window.setInterval(e,c)}}}),b.Application=function(a){var c=this;this.routes={},this.listeners=new b.Object({}),this.arounds=[],this.befores=[],this.namespace=(new Date).getTime()+"-"+parseInt(1e3*Math.random(),10),this.context_prototype=function(){b.EventContext.apply(this,arguments)},this.context_prototype.prototype=new b.EventContext,g(a)&&a.apply(this,[this]),this._location_proxy||this.setLocationProxy(new b.DefaultLocationProxy(this,this.run_interval_every)),this.debug&&this.bindToAllEvents(function(a,b){c.log(c.toString(),a.cleaned_type,b||{})})},b.Application.prototype=a.extend({},b.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:!1,element_selector:"body",debug:!1,raise_errors:!1,run_interval_every:50,disable_push_state:!1,template_engine:null,toString:function(){return"Sammy.Application:"+this.element_selector},$element:function(b){return b?a(this.element_selector).find(b):a(this.element_selector)},use:function(){var a=f(arguments),c=a.shift(),d=c||"";try{a.unshift(this),"string"==typeof c&&(d="Sammy."+c,c=b[c]),c.apply(this,a)}catch(e){"undefined"==typeof c?this.error("Plugin Error: called use() but plugin ("+d.toString()+") is not defined",e):g(c)?this.error("Plugin Error",e):this.error("Plugin Error: called use() but '"+d.toString()+"' is not a function",e)}return this},setLocationProxy:function(a){var b=this._location_proxy;this._location_proxy=a,this.isRunning()&&(b&&b.unbind(),this._location_proxy.bind())},log:function(){b.log.apply(b,Array.prototype.concat.apply([this.element_selector],arguments))},route:function(b,e){var f,h,i=this,j=[],k=Array.prototype.slice.call(arguments,2);if(0===k.length&&g(e)&&(k=[e],e=b,b="any"),b=b.toLowerCase(),e.constructor==String){for(d.lastIndex=0;null!==(h=d.exec(e));)j.push(h[1]);e=new RegExp(e.replace(d,c)+"$")}return a.each(k,function(a,b){"string"==typeof b&&(k[a]=i[b])}),f=function(a){var b={verb:a,path:e,callback:k,param_names:j};i.routes[a]=i.routes[a]||[],i.routes[a].push(b)},"any"===b?a.each(this.ROUTE_VERBS,function(a,b){f(b)}):f(b),this},get:m("get"),post:m("post"),put:m("put"),del:m("delete"),any:m("any"),mapRoutes:function(b){var c=this;return a.each(b,function(a,b){c.route.apply(c,b)}),this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(a,b,c){var d=this;"undefined"==typeof c&&(c=b);var e=function(){var a,b,e;a=arguments[0],e=arguments[1],e&&e.context?(b=e.context,delete e.context):b=new d.context_prototype(d,"bind",a.type,e,a.target),a.cleaned_type=a.type.replace(d.eventNamespace(),""),c.apply(b,[a,e])};return this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(e),this.isRunning()&&this._listen(a,e),this},trigger:function(a,b){return this.$element().trigger([a,this.eventNamespace()].join("."),[b]),this},refresh:function(){return this.last_location=null,this.trigger("location-changed"),this},before:function(a,b){return g(a)&&(b=a,a={}),this.befores.push([a,b]),this},after:function(a){return this.bind("event-context-after",a)},around:function(a){return this.arounds.push(a),this},onComplete:function(a){return this._onComplete=a,this},isRunning:function(){return this._running},helpers:function(b){return a.extend(this.context_prototype.prototype,b),this},helper:function(a,b){return this.context_prototype.prototype[a]=b,this},run:function(c){if(this.isRunning())return!1;var d=this;return a.each(this.listeners.toHash(),function(b,c){a.each(c,function(a,c){d._listen(b,c)})}),this.trigger("run",{start_url:c}),this._running=!0,this.last_location=null,/\#(.+)/.test(this.getLocation())||"undefined"==typeof c||this.setLocation(c),this._checkLocation(),this._location_proxy.bind(),this.bind("location-changed",function(){d._checkLocation()}),this.bind("submit",function(c){if(!b.targetIsThisWindow(c,"form"))return!0;var e=d._checkFormSubmission(a(c.target).closest("form"));return e===!1?c.preventDefault():!1}),a(window).bind("unload",function(){d.unload()}),this.trigger("changed")},unload:function(){if(!this.isRunning())return!1;var b=this;return this.trigger("unload"),this._location_proxy.unbind(),this.$element().unbind("submit").removeClass(b.eventNamespace()),a.each(this.listeners.toHash(),function(c,d){a.each(d,function(a,d){b._unlisten(c,d)})}),this._running=!1,this},destroy:function(){return this.unload(),delete b.apps[this.element_selector],this},bindToAllEvents:function(b){var c=this;return a.each(this.APP_EVENTS,function(a,d){c.bind(d,b)}),a.each(this.listeners.keys(!0),function(d,e){-1==a.inArray(e,c.APP_EVENTS)&&c.bind(e,b)}),this},routablePath:function(a){return a.replace(e,"")},lookupRoute:function(a,b){var c,d,e=this,f=!1,g=0;if("undefined"!=typeof this.routes[a])for(c=this.routes[a].length;c>g;g++)if(d=this.routes[a][g],e.routablePath(b).match(d.path)){f=d;break}return f},runRoute:function(b,c,d,e){var f,g,h,i,k,l,m,n,o=this,p=this.lookupRoute(b,c);if(this.debug&&this.log("runRoute",[b,c].join(" ")),this.trigger("run-route",{verb:b,path:c,params:d}),"undefined"==typeof d&&(d={}),a.extend(d,this._parseQueryString(c)),p){this.trigger("route-found",{route:p}),null!==(m=p.path.exec(this.routablePath(c)))&&(m.shift(),a.each(m,function(a,b){p.param_names[a]?d[p.param_names[a]]=j(b):(d.splat||(d.splat=[]),d.splat.push(j(b)))})),f=new this.context_prototype(this,b,c,d,e),h=this.arounds.slice(0),i=this.befores.slice(0),l=[f],d.splat&&(l=l.concat(d.splat)),g=function(){for(var a,b,c;i.length>0;)if(k=i.shift(),o.contextMatchesOptions(f,k[0])&&(a=k[1].apply(f,[f]),a===!1))return!1;return o.last_route=p,f.trigger("event-context-before",{context:f}),"function"==typeof p.callback&&(p.callback=[p.callback]),p.callback&&p.callback.length&&(b=-1,c=function(){b++,p.callback[b]?a=p.callback[b].apply(f,l):o._onComplete&&o._onComplete(f)},l.push(c),c()),f.trigger("event-context-after",{context:f}),a},a.each(h.reverse(),function(a,b){var c=g;g=function(){return b.apply(f,[c])}});try{n=g()}catch(q){this.error(["500 Error",b,c].join(" "),q)}return n}return this.notFound(b,c)},contextMatchesOptions:function(b,c,d){var e=c;if(("string"==typeof e||i(e))&&(e={path:e}),"undefined"==typeof d&&(d=!0),a.isEmptyObject(e))return!0;if(h(e.path)){var f,g,j,k;for(f=[],g=0,k=e.path.length;k>g;g+=1)j=a.extend({},e,{path:e.path[g]}),f.push(this.contextMatchesOptions(b,j));var l=a.inArray(!0,f)>-1;return d?l:!l}if(e.only)return this.contextMatchesOptions(b,e.only,!0);if(e.except)return this.contextMatchesOptions(b,e.except,!1);var m=!0,n=!0;return e.path&&(i(e.path)||(e.path=new RegExp(e.path.toString()+"$")),m=e.path.test(b.path)),e.verb&&(n="string"==typeof e.verb?e.verb===b.verb:e.verb.indexOf(b.verb)>-1),d?n&&m:!(n&&m)},getLocation:function(){return this._location_proxy.getLocation()},setLocation:function(a){return this._location_proxy.setLocation(a)},swap:function(a,b){var c=this.$element().html(a);return g(b)&&b(a),c},templateCache:function(a,b){return"undefined"!=typeof b?n[a]=b:n[a]},clearTemplateCache:function(){return n={}},notFound:function(a,b){var c=this.error(["404 Not Found",a,b].join(" "));return"get"===a?c:!0},error:function(a,b){if(b||(b=new Error),b.message=[a,b.message].join(" "),this.trigger("error",{message:b.message,error:b}),this.raise_errors)throw b;this.log(b.message,b)},_checkLocation:function(){var a,b;return a=this.getLocation(),this.last_location&&"get"==this.last_location[0]&&this.last_location[1]==a||(this.last_location=["get",a],b=this.runRoute("get",a)),b},_getFormVerb:function(b){var c,d,e=a(b);return d=e.find('input[name="_method"]'),d.length>0&&(c=d.val()),c||(c=e[0].getAttribute("method")),c&&""!==c||(c="get"),a.trim(c.toString().toLowerCase())},_checkFormSubmission:function(b){var c,d,e,f,g;return this.trigger("check-form-submission",{form:b}),c=a(b),d=c.attr("action")||"",e=this._getFormVerb(c),this.debug&&this.log("_checkFormSubmission",c,d,e),"get"===e?(f=this._serializeFormParams(c),""!==f&&(d+="?"+f),this.setLocation(d),g=!1):(f=a.extend({},this._parseFormParams(c)),g=this.runRoute(e,d,f,b.get(0))),"undefined"==typeof g?!1:g},_serializeFormParams:function(a){var b,c="",d=a.serializeArray();if(d.length>0)for(c=this._encodeFormPair(d[0].name,d[0].value),b=1;b<d.length;b++)c=c+"&"+this._encodeFormPair(d[b].name,d[b].value);return c},_encodeFormPair:function(a,b){return k(a)+"="+k(b)},_parseFormParams:function(a){var b,c={},d=a.serializeArray();for(b=0;b<d.length;b++)c=this._parseParamPair(c,d[b].name,d[b].value);return c},_parseQueryString:function(a){var b,c,d,f,g={};if(b=a.match(e),b&&b[1])for(c=b[1].split("&"),f=0;f<c.length;f++)d=c[f].split("="),g=this._parseParamPair(g,j(d[0]),j(d[1]||""));return g},_parseParamPair:function(a,b,c){return"undefined"!=typeof a[b]?h(a[b])?a[b].push(c):a[b]=[a[b],c]:a[b]=c,a},_listen:function(a,b){return this.$element().bind([a,this.eventNamespace()].join("."),b)},_unlisten:function(a,b){return this.$element().unbind([a,this.eventNamespace()].join("."),b)}}),b.RenderContext=function(a){this.event_context=a,this.callbacks=[],this.previous_content=null,this.content=null,this.next_engine=!1,this.waiting=!1},b.RenderContext.prototype=a.extend({},b.Object.prototype,{then:function(a){if(!g(a)){if(!("string"==typeof a&&a in this.event_context))return this;var b=this.event_context[a];a=function(a){return b.apply(this.event_context,[a])}}var c=this;return this.waiting?this.callbacks.push(a):(this.wait(),window.setTimeout(function(){var b=a.apply(c,[c.content,c.previous_content]);b!==!1&&c.next(b)},0)),this},wait:function(){this.waiting=!0},next:function(a){this.waiting=!1,"undefined"!=typeof a&&(this.previous_content=this.content,this.content=a),this.callbacks.length>0&&this.then(this.callbacks.shift())},load:function(b,c,d){var e=this;return this.then(function(){var f,h,i;return g(c)?(d=c,c={}):c=a.extend({},c),d&&this.then(d),"string"==typeof b?(i=b.match(/\.json(\?|$)/)||c.json,f=i?c.cache===!0:c.cache!==!1,e.next_engine=e.event_context.engineFor(b),delete c.cache,delete c.json,c.engine&&(e.next_engine=c.engine,delete c.engine),f&&(h=this.event_context.app.templateCache(b))?h:(this.wait(),a.ajax(a.extend({url:b,data:{},dataType:i?"json":"text",type:"get",success:function(a){f&&e.event_context.app.templateCache(b,a),e.next(a)}},c)),!1)):b.nodeType?b.innerHTML:b.selector?(e.next_engine=b.attr("data-engine"),c.clone===!1?b.remove()[0].innerHTML.toString():b[0].innerHTML.toString()):void 0})},loadPartials:function(a){var b;if(a){this.partials=this.partials||{};for(b in a)!function(b,c){b.load(a[c]).then(function(a){this.partials[c]=a})}(this,b)}return this},render:function(a,b,c,d){return g(a)&&!b?this.then(a):(g(b)?(d=c,c=b,b=null):c&&!g(c)&&(d=c,c=null),this.loadPartials(d).load(a).interpolate(b,a).then(c))},partial:function(a,b,c,d){return g(c)?this.render(a,b,d).swap(c):g(b)?this.render(a,{},c).swap(b):this.render(a,b,c).swap()},send:function(){var a=this,b=f(arguments),c=b.shift();return h(b[0])&&(b=b[0]),this.then(function(d){return b.push(function(b){a.next(b)}),a.wait(),c.apply(c,b),!1})},collect:function(b,c,d){var e=this,f=function(){g(b)&&(c=b,b=this.content);var d=[],f=!1;return a.each(b,function(a,b){var g=c.apply(e,[a,b]);return g.jquery&&1==g.length&&(g=g[0],f=!0),d.push(g),g}),f?d:d.join("")};return d?f():this.then(f)},renderEach:function(b,c,d,e){return h(c)&&(e=d,d=c,c=null),this.load(b).then(function(f){var g=this;return d||(d=h(this.previous_content)?this.previous_content:[]),e?void a.each(d,function(a,d){var h={},i=this.next_engine||b;c?h[c]=d:h=d,e(d,g.event_context.interpolate(f,h,i))}):this.collect(d,function(a,d){var e={},g=this.next_engine||b;return c?e[c]=d:e=d,this.event_context.interpolate(f,e,g)},!0)})},interpolate:function(a,b,c){var d=this;return this.then(function(e,f){!a&&f&&(a=f),this.next_engine&&(b=this.next_engine,this.next_engine=!1);var g=d.event_context.interpolate(e,a,b,this.partials);return c?f+g:g})},swap:function(a){return this.then(function(b){return this.event_context.swap(b,a),b}).trigger("changed",{})},appendTo:function(b){return this.then(function(c){a(b).append(c)}).trigger("changed",{})},prependTo:function(b){return this.then(function(c){a(b).prepend(c)}).trigger("changed",{})},replace:function(b){return this.then(function(c){a(b).html(c)}).trigger("changed",{})},trigger:function(a,b){return this.then(function(c){return"undefined"==typeof b&&(b={content:c}),this.event_context.trigger(a,b),c})}}),b.EventContext=function(a,c,d,e,f){this.app=a,this.verb=c,this.path=d,this.params=new b.Object(e),this.target=f},b.EventContext.prototype=a.extend({},b.Object.prototype,{$element:function(){return this.app.$element(f(arguments).shift())},engineFor:function(a){var b,c=this;return g(a)?a:(a=(a||c.app.template_engine).toString(),(b=a.match(/\.([^\.\?\#]+)(\?|$)/))&&(a=b[1]),a&&g(c[a])?c[a]:c.app.template_engine?this.engineFor(c.app.template_engine):function(a,b){return a})},interpolate:function(a,b,c,d){return this.engineFor(c).apply(this,[a,b,d])},render:function(a,c,d,e){return new b.RenderContext(this).render(a,c,d,e)},renderEach:function(a,c,d,e){return new b.RenderContext(this).renderEach(a,c,d,e)},load:function(a,c,d){return new b.RenderContext(this).load(a,c,d)},loadPartials:function(a){return new b.RenderContext(this).loadPartials(a)},partial:function(a,c,d,e){return new b.RenderContext(this).partial(a,c,d,e)},send:function(){var a=new b.RenderContext(this);return a.send.apply(a,arguments)},redirect:function(){var b,c=f(arguments),d=this.app.getLocation(),e=c.length;if(e>1){for(var g=0,h=[],i=[],j={},k=!1;e>g;g++)"string"==typeof c[g]?h.push(c[g]):(a.extend(j,c[g]),k=!0);if(b=h.join("/"),k){for(var l in j)i.push(this.app._encodeFormPair(l,j[l]));b+="?"+i.join("&")}}else b=c[0];this.trigger("redirect",{to:b}),this.app.last_location=[this.verb,this.path],this.app.setLocation(b),new RegExp(b).test(d)&&this.app.trigger("location-changed")},trigger:function(a,b){return"undefined"==typeof b&&(b={}),b.context||(b.context=this),this.app.trigger(a,b)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(a,b){return this.app.swap(a,b)},notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(b){return a.parseJSON(b)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}}),b});var NeighborhoodDataValidator=function(){var a={};return a.validLatitude=function(a){return"number"==typeof a&&a>=-90&&90>=a},a.validLongitude=function(a){return"number"==typeof a&&a>=-180&&180>=a},a.validCoordinates=function(a){var b=!0;if(a.geometry&&a.geometry.viewport&&a.geometry.viewport.getSouthWest&&a.geometry.viewport.getNorthEast&&a.geometry.viewport.getSouthWest().lat&&a.geometry.viewport.getSouthWest().lng&&a.geometry.viewport.getNorthEast().lat&&a.geometry.viewport.getNorthEast().lng){var c=a.geometry.viewport,d=c.getSouthWest().lat(),e=c.getNorthEast().lat(),f=c.getSouthWest().lng(),g=c.getNorthEast().lng();this.validLatitude(d)&&this.validLatitude(e)&&this.validLongitude(f)&&this.validLongitude(g)||(b=!1)}else b=!1;return b},a.validNameAndAddress=function(a){return"string"==typeof a.name&&"string"==typeof a.formatted_address},a.validNeighborhood=function(a){return this.validCoordinates(a)&&this.validNameAndAddress(a)},a}(),PlaceDataValidator=function(a){var b={};return b.validStringProperties=function(a){return"string"==typeof a.name&&"string"==typeof a.url},b.validLocation=function(a){return a.location&&a.location.address&&"string"==typeof a.location.address[0]},b.validLatitude=function(a){return"number"==typeof a&&a>=-90&&90>=a},b.validLongitude=function(a){return"number"==typeof a&&a>=-180&&180>=a},b.validCoordinate=function(a){if(a.location&&a.location.coordinate&&a.location.coordinate&&a.location.coordinate.latitude&&a.location.coordinate.longitude){var b=a.location.coordinate.latitude,c=a.location.coordinate.longitude;return this.validLatitude(b)&&this.validLongitude(c)}return!1},b.validRating=function(a){return"number"==typeof a.rating&&a.rating>=0&&a.rating<=5},b.validCategories=function(a){return a.categories&&a.categories[0]&&"string"==typeof a.categories[0][0]&&"string"==typeof a.categories[0][1]},b.validPlace=function(a){return this.validStringProperties(a)&&this.validLocation(a)&&this.validRating(a)&&this.validCategories(a)&&this.validCoordinate(a)},b}();